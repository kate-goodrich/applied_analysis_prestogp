---
title: "PrestoGP practice example with given data"
output: html_document
---


```{r setup, message=FALSE, warning=FALSE}
.libPaths("/usr/local/lib/R/site-library")
library(PrestoGP)
library(ggplot2)
set.seed(2025)
```


```{r load-data}
data(soil, package = "PrestoGP")
soil <- soil[!is.na(soil[,5]),]
y <- soil[,4]             # moisture content
X <- as.matrix(soil[,5:9])
locs <- as.matrix(soil[,1:2])
str(list(y=y, X=dim(X), locs=dim(locs)))
```

```{r fit-model}
soil.vm <- new("VecchiaModel", n_neighbors = 10)
soil.vm <- prestogp_fit(soil.vm, y, X, locs)
soil.vm
```

```{r impute-missing-y}
miss <- sample(1:nrow(soil), 20)
y.miss <- y
y.miss[miss] <- NA
soil.vm2 <- new("VecchiaModel", n_neighbors = 10)
soil.vm2 <- prestogp_fit(soil.vm2, y.miss, X, locs, impute.y = TRUE)
soil.vm2
```


```{r Impute-y-missing-due-to-limit-of-detection}
soil.lod <- quantile(y, 0.1)
y.lod <- y
y.lod[y.lod <= soil.lod] <- NA
soil.vm3 <- new("VecchiaModel", n_neighbors = 10)
soil.vm3 <- prestogp_fit(soil.vm3, y.lod, X, locs, impute.y = TRUE, lod.upper = soil.lod)
soil.vm3

```